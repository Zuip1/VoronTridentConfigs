
[include generic-bigtreetech-octopus.cfg]
[include config_backup.cfg]


[include fans, temps.cfg]
[include Orbiter2_SmartSensor.cfg]
[include TAP.cfg]

#---------------- DAEMON MACROS -------------------------
[include Macros.cfg]
[include mainsail.cfg]
[include ./Demon_Klipper_Essentials_Unified/*.cfg]
[include ./Demon_User_Files/*.cfg]
[include ./Demon_Klipper_Essentials_Unified/Other_Files/Demon_User_Files_Updater/Extract_Demon_User_Files_Biqu.cfg]

[include ./KAMP_LiTE/*.cfg]
[include mesh.cfg]
#[include KAMP_LiTE/.cfg]
#[include KAMP_LiTE/.cfg]
#[include ./Heat_Soak_SB_LEDs.cfg]
[include ./stealthburner_leds.cfg]



[mcu]
##  Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
##--------------------------------------------------------------------

serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_08003C001250335331383820-if00
restart_method: command
##--------------------------------------------------------------------

[mcu CanBus-EBB36] #CanBus-EBB36
#serial: /dev/serial/by-id/usb-Klipper_Klipper_firmware_12345-if00 #usb connection
canbus_uuid: f4abaa3ab7c0
# Found canbus_uuid=f4abaa3ab7c0, Application: Klipper
##--------------------------------------------------------------------
[mcu host]
serial: /tmp/klipper_host_mcu
##--------------------------------------------------------------------

[input_shaper]
shaper_freq_x: 51.2
shaper_type_x: mzv
shaper_freq_y: 38.4
shaper_type_y: zv

[printer]
kinematics: corexy
max_velocity: 300  
max_accel: 4000           #Max 4000
#max_accel_to_decel: 3500
max_z_velocity: 15          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0

[exclude_object]
[pause_resume]
[save_variables]
filename = ~/demon_vars.cfg


#####################################################################
#   X/Y Stepper Settings
#####################################################################

##  B Stepper - Left
##  Connected to MOTOR_0
##  Endstop connected to DIAG_0
[stepper_x]
step_pin: PF13
dir_pin: PF12
enable_pin: !PF14
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:200  #set to 400 for 0.9 degree stepper
endstop_pin: CanBus-EBB36: PB8
position_min: -1
##--------------------------------------------------------------------

position_endstop: 302
position_max: 302

##------------------------------------------------------------------
homing_speed: 100 #Max 100/25
homing_retract_dist: 10
homing_positive_dir: true

[tmc2209 stepper_x]
uart_pin: PC4
interpolate: False
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##  A Stepper - Right
##  Connected to MOTOR_1
##  Endstop connected to DIAG_1
[stepper_y]
step_pin: PG0
dir_pin: PG1
enable_pin: !PF15
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:200  #set to 400 for 0.9 degree stepper
endstop_pin: !PG6
position_min: 16
##--------------------------------------------------------------------

position_endstop: 315
position_max: 315

##--------------------------------------------------------------------
homing_speed: 100  #Max 100/25
homing_retract_dist: 10
homing_positive_dir: true

[tmc2209 stepper_y]
uart_pin: PD11
interpolate: False
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0
 
#####################################################################
#   Z Stepper Settings
#####################################################################

##  Z0 Stepper - Front Left
##  Connected to MOTOR_2
##  Endstop connected to DIAG_2
[stepper_z]
step_pin: PF11
dir_pin: PG3
enable_pin: !PG5
rotation_distance: 4   
microsteps: 32
endstop_pin: probe:z_virtual_endstop
##  After you run Z_ENDSTOP_CALIBRATE, position_endstop will be stored at the very end of your config
# position_endstop: 0
position_max: 248
position_min: -9
homing_speed: 8.0 # 10 max.
second_homing_speed: 3
homing_retract_dist: 3

[tmc2209 stepper_z]
uart_pin: PC6
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z1 Stepper - Rear Center
##  Connected to MOTOR_3
[stepper_z1]
step_pin: PG4
dir_pin: PC1
enable_pin: !PA0
rotation_distance: 4  
microsteps: 32

[tmc2209 stepper_z1]
uart_pin: PC7
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z2 Stepper - Front Right
##  Connected to MOTOR_4
[stepper_z2]
step_pin: PF9
dir_pin: PF10
enable_pin: !PG2
rotation_distance: 4
microsteps: 32

[tmc2209 stepper_z2]
uart_pin: PF2
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0

#####################################################################
#   Extruder
#####################################################################

#   Connected to MOTOR_6
#   Heater - PA2
#   Thermistor - PF4

[extruder]
step_pin: CanBus-EBB36:PD0
dir_pin: CanBus-EBB36:PD1
enable_pin: !CanBus-EBB36:PD2
rotation_distance: 41.955408
gear_ratio: 9:1
microsteps: 16
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
heater_pin: CanBus-EBB36:PB13

pressure_advance: 0.0235                 ##  Try to keep pressure_advance below 1.0 ; stock 0.05
pressure_advance_smooth_time: 0.040     ##  Default is 0.040, leave stock
max_extrude_only_velocity: 15
max_extrude_cross_section: 5

# - Less accurate PT1000 or  One of "EPCOS 100K B57560G104F", "ATC Semitec 104GT-2",
#   "ATC Semitec 104NT-4-R025H42G", "Generic 3950",
#   "Honeywell 100K 135-104LAG-J01", "NTC 100K MGB18-104F39050L32",
#   "SliceEngineering 450", or "TDK NTCG104LH104JT1"
##sensor_type: PT1000
##sensor_pin: CanBus-EBB36: PA3
##pullup_resistor: 4700

# - For more accurate PT1000 
sensor_type: MAX31865
sensor_pin: CanBus-EBB36: PA4
#spi_software_sclk_pin: CanBus-EBB36: PA5 # if it won't work
#spi_software_mosi_pin: CanBus-EBB36: PA7
#spi_software_miso_pin: CanBus-EBB36: PA6
spi_bus: spi1
rtd_nominal_r: 100
rtd_reference_r: 430
rtd_num_of_wires: 2

min_temp: -273.15
max_temp: 300
max_power: 1.0
min_extrude_temp: 150
control: pid
pid_Kp: 22.188
pid_Ki: 9.245
pid_Kd: 13.31

##  E0 on MOTOR6
[tmc2209 extruder]
uart_pin: CanBus-EBB36:PA15
interpolate: false
run_current: 0.6     # 0.5 Clockwork 2
sense_resistor: 0.110
stealthchop_threshold: 0

[firmware_retraction]
retract_length: 3
#   The length of filament (in mm) to retract when G10 is activated,
#   and to unretract when G11 is activated (but see
#   unretract_extra_length below). The default is 0 mm.
retract_speed: 20
#   The speed of retraction, in mm/s. The default is 20 mm/s.
#unretract_extra_length: 0
#   The length (in mm) of *additional* filament to add when
#   unretracting.
#unretract_speed: 10
#   The speed of unretraction, in mm/s. The default is 10 mm/s.

#####################################################################
#   Bed Heater and sensors
#####################################################################

[heater_bed]
##  SSR Pin - HE1
##  Thermistor - TB
heater_pin: PA3
#sensor_type: Generic 3950
sensor_type: PT1000
sensor_pin: PF3
max_power: 0.7
min_temp: -100 
max_temp: 140
control: pid
#pid_kp: 21.190
#pid_ki: 1.139
#pid_kd: 98.533
pid_kp: 40.748
pid_ki: 1.607
pid_kd: 258.239

[verify_heater heater_bed]
max_error: 130
check_gain_time: 120
hysteresis: 5
heating_gain: 0.5


#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
gcode:
    _DEMON_IDLE_TIMEOUT
timeout: 3600

#[safe_z_home]
#home_xy_position:150,150
#speed:500
#z_hop:10

[force_move]
enable_force_move: True

[z_tilt]
z_positions:
  -50, 18
  150, 348
  350, 18
points:
  30, 30
  150, 290
  270, 30

speed: 350
horizontal_move_z: 10
retries: 4
retry_tolerance: 0.01


# z_offset = -1.230
# overwritten offset: z_offset = -1.365,  -1.855

#---------------------------------------------------------------------

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [probe]
#*# z_offset = -1.365
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.057500, -0.050313, -0.079063, -0.054688, -0.049375
#*# 	-0.031875, -0.016250, -0.020000, 0.003750, 0.034062
#*# 	-0.051875, -0.028125, -0.008438, 0.000312, 0.031875
#*# 	-0.116875, -0.102813, -0.056875, -0.029375, -0.010938
#*# 	-0.149063, -0.137500, -0.104375, -0.080625, -0.082813
#*# x_count = 5
#*# y_count = 5
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = lagrange
#*# tension = 0.2
#*# min_x = 50.0
#*# max_x = 260.0
#*# min_y = 50.0
#*# max_y = 260.0
#*#
#*# [input_shaper]
